<!DOCTYPE html>
<html>
<head>
<title>OOP_Tutoring.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/*
 * Visual Studio 2015 dark style
 * Author: Nicolas LLOBERA <nllobera@gmail.com>
 */

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #1E1E1E;
  color: #DCDCDC;
}

.hljs-keyword,
.hljs-literal,
.hljs-symbol,
.hljs-name {
  color: #569CD6;
}
.hljs-link {
  color: #569CD6;
  text-decoration: underline;
}

.hljs-built_in,
.hljs-type {
  color: #4EC9B0;
}

.hljs-number,
.hljs-class {
  color: #B8D7A3;
}

.hljs-string,
.hljs-meta-string {
  color: #D69D85;
}

.hljs-regexp,
.hljs-template-tag {
  color: #9A5334;
}

.hljs-subst,
.hljs-function,
.hljs-title,
.hljs-params,
.hljs-formula {
  color: #DCDCDC;
}

.hljs-comment,
.hljs-quote {
  color: #57A64A;
  font-style: italic;
}

.hljs-doctag {
  color: #608B4E;
}

.hljs-meta,
.hljs-meta-keyword,
.hljs-tag {
  color: #9B9B9B;
}

.hljs-variable,
.hljs-template-variable {
  color: #BD63C5;
}

.hljs-attr,
.hljs-attribute,
.hljs-builtin-name {
  color: #9CDCFE;
}

.hljs-section {
  color: gold;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

/*.hljs-code {
  font-family:'Monospace';
}*/

.hljs-bullet,
.hljs-selector-tag,
.hljs-selector-id,
.hljs-selector-class,
.hljs-selector-attr,
.hljs-selector-pseudo {
  color: #D7BA7D;
}

.hljs-addition {
  background-color: #144212;
  display: inline-block;
  width: 100%;
}

.hljs-deletion {
  background-color: #600;
  display: inline-block;
  width: 100%;
}

</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>
<link rel="stylesheet" href="github-markdown-dark.css" type="text/css">
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body class="markdown-body">
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="%F0%9F%A7%B1-%E7%AC%AC-1-%E7%AB%A0oop-%E5%9F%BA%E7%A4%8E%E8%A7%80%E5%BF%B5">🧱 第 1 章：OOP 基礎觀念</h1>
<h2 id="%F0%9F%8E%93-%E6%95%99%E5%AD%B8%E7%9B%AE%E6%A8%99">🎓 教學目標</h2>
<ol>
<li>瞭解物件導向（OOP）與程序式程式設計的差異</li>
<li>掌握 OOP 的四大支柱：封裝、繼承、多型、抽象</li>
<li>了解 C# 作為 OOP 語言的基本設計理念</li>
</ol>
<hr>
<h2 id="%F0%9F%A7%AD-1-%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E7%AF%84%E5%BC%8F%E7%B0%A1%E4%BB%8B">🧭 1. 程式設計範式簡介</h2>
<h3 id="%E2%9C%85-%E7%A8%8B%E5%BA%8F%E5%BC%8Fprocedural-programming">✅ 程序式（Procedural Programming）</h3>
<ul>
<li>將問題分解為一連串的「指令、流程與資料」</li>
<li>常用於小型腳本或處理流程線性簡單的場景</li>
</ul>
<h3 id="%E2%9C%85-%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91object-oriented-programming">✅ 物件導向（Object-Oriented Programming）</h3>
<ul>
<li>強調「資料（狀態）」與「行為（方法）」封裝在一起</li>
<li>程式架構較具彈性與可重用性</li>
</ul>
<table>
<thead>
<tr>
<th>比較項目</th>
<th>程序式</th>
<th>物件導向</th>
</tr>
</thead>
<tbody>
<tr>
<td>單元單位</td>
<td>函式、流程</td>
<td>類別、物件</td>
</tr>
<tr>
<td>資料與邏輯</td>
<td>分離</td>
<td>封裝在物件中</td>
</tr>
<tr>
<td>重用方式</td>
<td>複製貼上</td>
<td>繼承與多型</td>
</tr>
<tr>
<td>範例語言</td>
<td>C, Python（某些寫法）</td>
<td>C#, Java, C++, Swift</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="%F0%9F%A7%AD-2-oop-%E7%9A%84%E5%9B%9B%E5%A4%A7%E6%94%AF%E6%9F%B1">🧭 2. OOP 的四大支柱</h2>
<h3 id="%F0%9F%9F%A6-21-%E5%B0%81%E8%A3%9Dencapsulation">🟦 2.1 封裝（Encapsulation）</h3>
<ul>
<li>將資料和方法打包在一起，並隱藏內部的複雜實作</li>
<li>外部只能透過「方法」與「屬性」操作內部狀態</li>
</ul>
<h3 id="%F0%9F%9F%AA-22-%E7%B9%BC%E6%89%BFinheritance">🟪 2.2 繼承（Inheritance）</h3>
<ul>
<li>子類別可以繼承父類別的屬性與方法</li>
<li>可減少重複程式碼</li>
</ul>
<h3 id="%F0%9F%9F%A5-23-%E5%A4%9A%E5%9E%8Bpolymorphism">🟥 2.3 多型（Polymorphism）</h3>
<ul>
<li>
<p>同樣的方法呼叫，對不同物件有不同的行為</p>
</li>
<li>
<p>分為：</p>
<ul>
<li>多載（overload）</li>
<li>覆寫（override）</li>
</ul>
</li>
</ul>
<h3 id="%F0%9F%9F%A8-24-%E6%8A%BD%E8%B1%A1abstraction">🟨 2.4 抽象（Abstraction）</h3>
<ul>
<li>
<p>隱藏內部實作細節，只暴露必要的操作介面</p>
</li>
<li>
<p>實現方式：</p>
<ul>
<li>抽象類別</li>
<li>介面（interface）</li>
</ul>
</li>
</ul>
<hr>
<h2 id="%F0%9F%9B%A0-%E7%AF%84%E4%BE%8Boop-%E5%9B%9B%E5%A4%A7%E6%94%AF%E6%9F%B1">🛠 範例：OOP 四大支柱</h2>
<pre class="hljs"><code><div><span class="hljs-comment">// 封裝 + 繼承 + 多型 + 抽象簡介</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Speak</span>(<span class="hljs-params"></span>)</span>;      <span class="hljs-comment">// 抽象方法</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span> : <span class="hljs-title">Animal</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Speak</span>(<span class="hljs-params"></span>)       <span class="hljs-comment">// 多型 (override)</span></span>
    {
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{Name}</span>：汪汪！"</span>);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Cat</span> : <span class="hljs-title">Animal</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Speak</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{Name}</span>：喵喵～"</span>);
    }
}
</div></code></pre>
<h3 id="%F0%9F%93%8C-%E6%B8%AC%E8%A9%A6%E7%A8%8B%E5%BC%8F">📌 測試程式</h3>
<pre class="hljs"><code><div>Animal dog = <span class="hljs-keyword">new</span> Dog { Name = <span class="hljs-string">"小白"</span> };
Animal cat = <span class="hljs-keyword">new</span> Cat { Name = <span class="hljs-string">"小花"</span> };
dog.Speak();   <span class="hljs-comment">// 小白：汪汪！</span>
cat.Speak();   <span class="hljs-comment">// 小花：喵喵～</span>
</div></code></pre>
<hr>
<h1 id="%F0%9F%93%98-%E7%AC%AC-2-%E7%AB%A0%E5%B0%81%E8%A3%9Dencapsulation">📘 第 2 章：封裝（Encapsulation）</h1>
<h2 id="%F0%9F%8E%AF-%E6%95%99%E5%AD%B8%E7%9B%AE%E6%A8%99">🎯 教學目標</h2>
<ul>
<li>瞭解封裝在 OOP 中的角色與重要性</li>
<li>熟悉 C# 權限修飾詞的運作與應用</li>
<li>實作屬性 (<code>property</code>) 控制資料存取與驗證</li>
<li>建立具備資料保護機制的類別設計能力</li>
</ul>
<hr>
<h2 id="%F0%9F%A7%B1-%E5%B0%81%E8%A3%9D%E6%A6%82%E5%BF%B5%E8%AA%AA%E6%98%8E">🧱 封裝概念說明</h2>
<h3 id="%E4%BB%80%E9%BA%BC%E6%98%AF%E5%B0%81%E8%A3%9D">什麼是封裝？</h3>
<p>封裝是一種將<strong>資料與行為綁在一起</strong>，並<strong>限制外部直接存取資料</strong>的技術，
就像你使用微波爐時，只需要按按鈕（公開的介面），而不需要知道內部的電路如何運作（私有的實作）。</p>
<p>透過封裝可以：</p>
<ul>
<li>隱藏內部實作細節（提高安全性）</li>
<li>控制對欄位的存取與驗證（提高穩定性）</li>
</ul>
<hr>
<h2 id="%F0%9F%94%90-%E6%AC%8A%E9%99%90%E4%BF%AE%E9%A3%BE%E8%A9%9Eaccess-modifiers">🔐 權限修飾詞（Access Modifiers）</h2>
<table>
<thead>
<tr>
<th>修飾詞</th>
<th>存取範圍說明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>public</code></td>
<td>任何地方都能存取</td>
</tr>
<tr>
<td><code>private</code></td>
<td>僅限於類別內部可存取（封裝的核心）</td>
</tr>
<tr>
<td><code>protected</code></td>
<td>僅限於類別內部與其子類別可存取</td>
</tr>
<tr>
<td><code>internal</code></td>
<td>僅限於同一命名空間/專案(Assembly)中的類別可存取（進階使用）</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="%F0%9F%93%A6-%E4%BD%BF%E7%94%A8%E5%B1%AC%E6%80%A7%E5%B0%81%E8%A3%9D%E6%AC%84%E4%BD%8D%E4%BB%A5-facade%E5%A4%96%E8%A7%80%E6%A8%A1%E5%BC%8F%E7%82%BA%E4%BE%8B">📦 使用屬性封裝欄位，以 Facade（外觀）模式為例</h2>
<h3 id="%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E9%8A%80%E8%A1%8C%E6%AB%83%E5%93%A1%E5%B0%B1%E6%98%AF%E4%B8%80%E5%80%8B%E5%B0%81%E8%A3%9D%E5%BE%8C%E7%9A%84%E4%BB%8B%E9%9D%A2">核心概念：銀行櫃員就是一個封裝後的介面</h3>
<p>想像一下你去銀行辦理提款。你只需要走到櫃檯，把你的提款單及資料交給櫃員，然後告訴他要提多少錢。</p>
<p>這位<strong>櫃員就是一個「Facade」</strong>。</p>
<p>在你看不見的背後，櫃員可能需要做好幾件事：</p>
<ol>
<li><strong>驗證帳戶</strong>：確認你的帳號是否存在。</li>
<li><strong>安全檢查</strong>：確認你的密碼是否正確。</li>
<li><strong>資金確認</strong>：檢查你的帳戶餘額是否足夠。</li>
<li><strong>執行扣款</strong>：從你的帳戶中扣除金額。</li>
<li><strong>記錄交易</strong>：在銀行的交易日誌上留下紀錄。</li>
</ol>
<p>你不需要親自去跟「帳戶系統」、「安全系統」、「資金系統」打交道。你只需要跟「櫃員」這個單一窗口溝通。Facade 模式就是扮演這位櫃員的角色，將背後複雜的流程簡化成一個簡單的操作。</p>
<hr>
<h3 id="c-%E7%A8%8B%E5%BC%8F%E7%A2%BC%E7%AF%84%E4%BE%8B">C# 程式碼範例</h3>
<h4 id="1-%E8%A4%87%E9%9B%9C%E7%9A%84%E9%8A%80%E8%A1%8C%E5%BE%8C%E7%AB%AF%E5%AD%90%E7%B3%BB%E7%B5%B1-the-complex-subsystems">1. 複雜的銀行後端子系統 (The Complex Subsystems)</h4>
<p>這些是銀行內部處理不同業務的系統，客戶通常不會直接接觸它們。</p>
<pre class="hljs"><code><div><span class="hljs-comment">// 子系統1：帳戶驗證系統</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AccountService</span>
{
    <span class="hljs-comment">// 模擬檢查帳戶是否存在</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">CheckAccount</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> accountNumber</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"  [子系統] 正在驗證帳號：<span class="hljs-subst">{accountNumber}</span>"</span>);
        <span class="hljs-keyword">if</span> (accountNumber == <span class="hljs-string">"123-456-789"</span>)
        {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        Console.WriteLine(<span class="hljs-string">"  [子系統] 錯誤：帳號不存在。"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-comment">// 子系統2：安全驗證系統</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SecurityService</span>
{
    <span class="hljs-comment">// 模擬檢查密碼是否正確</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">CheckPinCode</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> accountNumber, <span class="hljs-keyword">int</span> pin</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"  [子系統] 正在驗證密碼..."</span>);
        <span class="hljs-keyword">if</span> (accountNumber == <span class="hljs-string">"123-456-789"</span> &amp;&amp; pin == <span class="hljs-number">8888</span>)
        {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        Console.WriteLine(<span class="hljs-string">"  [子系統] 錯誤：密碼錯誤。"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-comment">// 子系統3：資金管理系統</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FundsService</span>
{
    <span class="hljs-comment">// 模擬帳戶餘額</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">decimal</span> _balance = <span class="hljs-number">10000</span>m;

    <span class="hljs-comment">// 模擬檢查餘額是否足夠</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">HasSufficientFunds</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"  [子系統] 正在檢查餘額..."</span>);
        <span class="hljs-keyword">if</span> (_balance &gt;= amount)
        {
            Console.WriteLine(<span class="hljs-string">$"  [子系統] 目前餘額: <span class="hljs-subst">{_balance:C}</span>，足夠提款。"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        Console.WriteLine(<span class="hljs-string">$"  [子系統] 錯誤：餘額不足！目前餘額: <span class="hljs-subst">{_balance:C}</span>"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 模擬存款</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Deposit</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span>
    {
        _balance += amount;
        Console.WriteLine(<span class="hljs-string">$"  [子系統] 成功存入 <span class="hljs-subst">{amount:C}</span>。"</span>);
    }

    <span class="hljs-comment">// 模擬提款</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Withdraw</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span>
    {
        _balance -= amount;
        Console.WriteLine(<span class="hljs-string">$"  [子系統] 成功提出 <span class="hljs-subst">{amount:C}</span>。"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ShowBalance</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"  [子系統] 目前帳戶最終餘額為: <span class="hljs-subst">{_balance:C}</span>"</span>);
    }
}
</div></code></pre>
<h4 id="2-%E9%8A%80%E8%A1%8C%E6%AB%83%E5%93%A1%E5%A4%96%E8%A7%80%E9%A1%9E%E5%88%A5-the-bankaccount-facade">2. 銀行櫃員外觀類別 (The BankAccount Facade)</h4>
<p>這個 <code>BankAccountFacade</code> 就是我們的櫃員。它簡化了所有操作，提供給客戶 <code>Deposit</code> 和 <code>Withdraw</code> 兩個簡單的方法。</p>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BankAccountFacade</span>
{
    <span class="hljs-comment">// Facade 持有所有子系統的參考</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> _accountNumber;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> _pin;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> AccountService _accountService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> SecurityService _securityService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> FundsService _fundsService;

    <span class="hljs-comment">// 客戶開戶時，就建立好所有需要的服務</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BankAccountFacade</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> accountNumber, <span class="hljs-keyword">int</span> pin</span>)</span>
    {
        _accountNumber = accountNumber;
        _pin = pin;

        <span class="hljs-comment">// 初始化所有子系統</span>
        _accountService = <span class="hljs-keyword">new</span> AccountService();
        _securityService = <span class="hljs-keyword">new</span> SecurityService();
        _fundsService = <span class="hljs-keyword">new</span> FundsService();
    }

    <span class="hljs-comment">// 提供給客戶的「存款」單一方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Deposit</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"\n======= 開始處理存款 <span class="hljs-subst">{amount:C}</span> ======="</span>);
        <span class="hljs-comment">// 1. 驗證帳號</span>
        <span class="hljs-keyword">if</span> (!_accountService.CheckAccount(_accountNumber)) <span class="hljs-keyword">return</span>;
        <span class="hljs-comment">// 2. 驗證密碼</span>
        <span class="hljs-keyword">if</span> (!_securityService.CheckPinCode(_accountNumber, _pin)) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// 3. 執行存款</span>
        _fundsService.Deposit(amount);
        _fundsService.ShowBalance();
        Console.WriteLine(<span class="hljs-string">"======= 存款處理完成 ======="</span>);
    }

    <span class="hljs-comment">// 提供給客戶的「提款」單一方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Withdraw</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> amount</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"\n======= 開始處理提款 <span class="hljs-subst">{amount:C}</span> ======="</span>);
        <span class="hljs-comment">// 1. 驗證帳號</span>
        <span class="hljs-keyword">if</span> (!_accountService.CheckAccount(_accountNumber)) <span class="hljs-keyword">return</span>;
        <span class="hljs-comment">// 2. 驗證密碼</span>
        <span class="hljs-keyword">if</span> (!_securityService.CheckPinCode(_accountNumber, _pin)) <span class="hljs-keyword">return</span>;
        <span class="hljs-comment">// 3. 檢查餘額</span>
        <span class="hljs-keyword">if</span> (!_fundsService.HasSufficientFunds(amount)) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// 4. 執行提款</span>
        _fundsService.Withdraw(amount);
        _fundsService.ShowBalance();
        Console.WriteLine(<span class="hljs-string">"======= 提款處理完成 ======="</span>);
    }
}
</div></code></pre>
<h4 id="3-%E5%AE%A2%E6%88%B6%E7%AB%AF-the-client">3. 客戶端 (The Client)</h4>
<p>客戶（也就是我們）只需要跟 <code>BankAccountFacade</code> 互動，完全不用理會後端的複雜系統。</p>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span>
    {
        <span class="hljs-comment">// 客戶來到銀行，只需要提供帳號密碼給櫃員(Facade)</span>
        <span class="hljs-keyword">var</span> myAccount = <span class="hljs-keyword">new</span> BankAccountFacade(<span class="hljs-string">"123-456-789"</span>, <span class="hljs-number">8888</span>);

        <span class="hljs-comment">// === 案例1：成功提款 ===</span>
        myAccount.Withdraw(<span class="hljs-number">500</span>m);

        <span class="hljs-comment">// === 案例2：成功存款 ===</span>
        myAccount.Deposit(<span class="hljs-number">2000</span>m);

        <span class="hljs-comment">// === 案例3：提款失敗 (餘額不足) ===</span>
        myAccount.Withdraw(<span class="hljs-number">20000</span>m);

        <span class="hljs-comment">// === 案例4：使用錯誤的密碼進行操作 ===</span>
        <span class="hljs-keyword">var</span> wrongAccount = <span class="hljs-keyword">new</span> BankAccountFacade(<span class="hljs-string">"123-456-789"</span>, <span class="hljs-number">9999</span>);
        wrongAccount.Withdraw(<span class="hljs-number">100</span>m);
    }
}
</div></code></pre>
<h3 id="%E5%9F%B7%E8%A1%8C%E7%B5%90%E6%9E%9C">執行結果</h3>
<p>執行程式後，輸出結果非常清晰地展示了整個流程：</p>
<pre class="hljs"><code><div>======= 開始處理提款 NT$500.00 =======
  [子系統] 正在驗證帳號：123-456-789
  [子系統] 正在驗證密碼...
  [子系統] 正在檢查餘額...
  [子系統] 目前餘額: NT$10,000.00，足夠提款。
  [子系統] 成功提出 NT$500.00。
  [子系統] 目前帳戶最終餘額為: NT$9,500.00
======= 提款處理完成 =======

======= 開始處理存款 NT$2,000.00 =======
  [子系統] 正在驗證帳號：123-456-789
  [子系統] 正在驗證密碼...
  [子系統] 成功存入 NT$2,000.00。
  [子系統] 目前帳戶最終餘額為: NT$11,500.00
======= 存款處理完成 =======

======= 開始處理提款 NT$20,000.00 =======
  [子系統] 正在驗證帳號：123-456-789
  [子系統] 正在驗證密碼...
  [子系統] 正在檢查餘額...
  [子系統] 錯誤：餘額不足！目前餘額: NT$11,500.00

======= 開始處理提款 NT$100.00 =======
  [子系統] 正在驗證帳號：123-456-789
  [子系統] 正在驗證密碼...
  [子系統] 錯誤：密碼錯誤。
</div></code></pre>
<p>這個範例清楚地顯示，客戶端程式碼非常簡單，只需要呼叫 <code>myAccount.Withdraw()</code> 和 <code>myAccount.Deposit()</code>。所有帳戶、安全、資金的檢查邏輯都被完美地封裝在 <code>BankAccountFacade</code> 裡面了。</p>
<hr>
<h1 id="%F0%9F%93%98-%E7%AC%AC-3-%E7%AB%A0%E7%B9%BC%E6%89%BF%E8%88%87%E5%A4%9A%E5%9E%8Binheritance--polymorphism">📘 第 3 章：繼承與多型（Inheritance &amp; Polymorphism）</h1>
<h2 id="%F0%9F%8E%AF-%E6%95%99%E5%AD%B8%E7%9B%AE%E6%A8%99">🎯 教學目標</h2>
<ul>
<li>理解繼承的概念與語法</li>
<li>能夠定義父類別與子類別</li>
<li>瞭解多型的應用方式（方法覆寫、虛擬方法）</li>
<li>熟悉 <code>base</code>, <code>virtual</code>, <code>override</code>, <code>new</code> 的用法</li>
</ul>
<hr>
<h2 id="%F0%9F%A7%AC-%E7%B9%BC%E6%89%BF%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">🧬 繼承的基本概念</h2>
<h3 id="%E5%AE%9A%E7%BE%A9">定義</h3>
<ul>
<li>繼承（Inheritance）是讓一個類別（子類別）繼承另一個類別（父類別）的屬性與行為</li>
<li>可用來共用邏輯、擴充功能、建立層次關係</li>
</ul>
<h3 id="%E8%AA%9E%E6%B3%95">語法：</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Name;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Animal</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span>
    {
        <span class="hljs-keyword">this</span>.Name = name;
        Console.WriteLine(<span class="hljs-string">"Animal 的建構函式被呼叫。"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Eat</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{Name}</span> 正在吃東西。"</span>);
    }
}

<span class="hljs-comment">//Dog是一種Animal，故Animal有的一般特性Dog也都會有。</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span> : <span class="hljs-title">Animal</span>
{
    <span class="hljs-comment">//Dog 將擁有 Name 及 Eat 功能</span>
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%9A-%E4%BD%BF%E7%94%A8-base-%E9%97%9C%E9%8D%B5%E5%AD%97">📚 使用 <code>base</code> 關鍵字</h2>
<ul>
<li><code>base</code> 可以呼叫父類別的建構子或成員</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span> : <span class="hljs-title">Animal</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Dog</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">name</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"Dog 的建構函式被呼叫。"</span>);
    }
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%94%81-%E6%96%B9%E6%B3%95%E8%A6%86%E5%AF%ABoverride">🔁 方法覆寫（Override）</h2>
<ul>
<li>C# 支援<strong>虛擬方法</strong>（virtual）與<strong>覆寫方法</strong>（override）</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span>
{
    <span class="hljs-comment">//虛擬方法 (virtual)，允許被子類覆寫</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Speak</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"不特定的聲音"</span>);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Cat</span> : <span class="hljs-title">Animal</span>
{
    <span class="hljs-comment">//被子類別 Cat 覆寫</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Speak</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"喵喵！"</span>);
    }
}
</div></code></pre>
<hr>
<h2 id="%E2%9C%82%EF%B8%8F-%E4%BD%BF%E7%94%A8-new-%E9%9A%B1%E8%97%8F%E6%88%90%E5%93%A1">✂️ 使用 <code>new</code> 隱藏成員</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Pig</span> : <span class="hljs-title">Animal</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> new <span class="hljs-keyword">void</span> <span class="hljs-title">Speak</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"哼哼！"</span>);
    }

    <span class="hljs-comment">//Pigs 獨有的 Method: 獻祭</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Sacrificed</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"我願走上神桌，只盼今後國泰民安、風調雨順!"</span>);
    }
}
</div></code></pre>
<p>📌 注意：<code>new</code> 並不會覆蓋原本的方法，而會讓父類別與子類別擁有 2 個同名的函式。</p>
<hr>
<h2 id="%F0%9F%94%81-%E5%A4%9A%E5%9E%8Bpolymorphism">🔁 多型（Polymorphism）</h2>
<ul>
<li>多型允許用父類型參考子物件，呼叫虛擬方法時會執行實際類型的實作</li>
</ul>
<pre class="hljs"><code><div>Animal a = <span class="hljs-keyword">new</span> Cat();
a.Speak(); <span class="hljs-comment">// 輸出：喵喵！ (override)</span>

a = <span class="hljs-keyword">new</span> Pig();
a.Speak(); <span class="hljs-comment">// 輸出：不特定的聲音（new）</span>

Pig _pig = <span class="hljs-keyword">new</span> Pig();
_pig.Speak(); <span class="hljs-comment">// 輸出：哼哼！（new）</span>
</div></code></pre>
<hr>
<h2 id="%F0%9F%A7%AA-%E5%AF%A6%E4%BD%9C%E7%AF%84%E4%BE%8B">🧪 實作範例</h2>
<pre class="hljs"><code><div>List&lt;Animal&gt; zoo = <span class="hljs-keyword">new</span> List&lt;Animal&gt;
{
    <span class="hljs-keyword">new</span> Dog { Name = <span class="hljs-string">"小黃"</span> },
    <span class="hljs-keyword">new</span> Cat { Name = <span class="hljs-string">"小白"</span> },
    <span class="hljs-keyword">new</span> Pig { Name = <span class="hljs-string">"小黑"</span> }
};

<span class="hljs-keyword">foreach</span> (Animal animal <span class="hljs-keyword">in</span> zoo)
{
    animal.Speak(); <span class="hljs-comment">// 執行對應的多型方法</span>
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%9D-%E7%B7%B4%E7%BF%92%E9%A1%8C">📝 練習題</h2>
<h3 id="%E9%A1%8C%E7%9B%AE-1">題目 1：</h3>
<p>定義以下類別繼承關係：</p>
<ul>
<li><code>Vehicle</code>：基本資訊、方法 <code>Start()</code></li>
<li><code>Car</code>、<code>Bus</code>、<code>Bike</code> 繼承 <code>Vehicle</code> 並覆寫 <code>Start()</code> 行為</li>
</ul>
<h3 id="%E9%A1%8C%E7%9B%AE-2">題目 2：</h3>
<p>建立 <code>Shape</code> 類別，並由其繼承出 <code>Circle</code> 與 <code>Square</code>，定義虛擬方法 <code>GetArea()</code> 並覆寫。</p>
<hr>
<h2 id="%E2%9C%85-%E7%B7%B4%E7%BF%92%E9%A1%8C%E8%A7%A3%E7%AD%94">✅ 練習題解答</h2>
<h3 id="%E9%A1%8C%E7%9B%AE-1-%E8%A7%A3%E7%AD%94">題目 1 解答：</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Vehicle</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">"啟動交通工具"</span>);
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> : <span class="hljs-title">Vehicle</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">"汽車發動！"</span>);
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Bus</span> : <span class="hljs-title">Vehicle</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">"公車啟動！"</span>);
}
</div></code></pre>
<h3 id="%E9%A1%8C%E7%9B%AE-2-%E8%A7%A3%E7%AD%94">題目 2 解答：</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Shape</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">double</span> <span class="hljs-title">GetArea</span>(<span class="hljs-params"></span>)</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Circle</span> : <span class="hljs-title">Shape</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> Radius { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">double</span> <span class="hljs-title">GetArea</span>(<span class="hljs-params"></span>)</span> =&gt; Math.PI * Radius * Radius;
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%8C-%E5%9E%8B%E5%88%A5%E8%BD%89%E5%9E%8B">📌 型別轉型</h2>
<pre class="hljs"><code><div><span class="hljs-comment">//向上轉型 (Upcasting，我個人稱之為「大轉小」)</span>
Dog dog = <span class="hljs-keyword">new</span> Dog();
Animal animal = dog;
animal.Speak(); <span class="hljs-comment">//汪汪</span>

<span class="hljs-comment">//向下轉型 (Downcasting，我個人稱之為「小轉大」)</span>
Pig pig = animal <span class="hljs-keyword">as</span> Pig; <span class="hljs-comment">//建議使用 as</span>

<span class="hljs-comment">//as 轉型成功，pig 會得到物件參考；</span>
<span class="hljs-comment">//如果失敗（例如 animal 其實是 Dog），pig 會被設為 null，不會拋出例外。</span>
<span class="hljs-comment">//後續需要檢查 if (myDog != null)。</span>

<span class="hljs-comment">//強制轉型： Pig pig = (Pig)animal;</span>
<span class="hljs-comment">//如果轉型失敗，會直接拋出 InvalidCastException 例外。</span>
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%9A-%E5%B0%8F%E7%B5%90">📚 小結</h2>
<table>
<thead>
<tr>
<th>概念</th>
<th>關鍵字</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>繼承</td>
<td><code>:</code></td>
<td>擴充父類別功能</td>
</tr>
<tr>
<td>多型</td>
<td><code>virtual</code>, <code>override</code></td>
<td>執行時決定呼叫哪個方法</td>
</tr>
<tr>
<td>隱藏</td>
<td><code>new</code></td>
<td>編譯時決定隱藏原本成員</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="%F0%9F%93%98-%E7%AC%AC-4-%E7%AB%A0%E6%8A%BD%E8%B1%A1%E9%A1%9E%E5%88%A5%E8%88%87%E4%BB%8B%E9%9D%A2abstract-classes--interfaces">📘 第 4 章：抽象類別與介面（Abstract Classes &amp; Interfaces）</h1>
<h2 id="%F0%9F%8E%AF-%E6%95%99%E5%AD%B8%E7%9B%AE%E6%A8%99">🎯 教學目標</h2>
<ul>
<li>了解抽象類別與介面的差異與用途</li>
<li>實作抽象類別與介面</li>
<li>學會使用多介面設計、擴充與組合系統</li>
<li>熟悉抽象化在物件導向中的實務應用</li>
</ul>
<hr>
<h2 id="%F0%9F%A7%B1-%E6%8A%BD%E8%B1%A1%E9%A1%9E%E5%88%A5abstract-class">🧱 抽象類別（abstract class）</h2>
<h3 id="%E5%AE%9A%E7%BE%A9">定義</h3>
<p>抽象類別是一種**不能被實例化(new)**的類別，它存在的目的就是為了被繼承。其中可包含：</p>
<ul>
<li>已實作的方法與屬性（行為模板）</li>
<li>未實作的方法（抽象方法）</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Speak</span>(<span class="hljs-params"></span>)</span>;  <span class="hljs-comment">// 抽象方法：子類別必須實作</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Sleep</span>(<span class="hljs-params"></span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{Name}</span> 在睡覺..."</span>);
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%94%BB-%E5%AF%A6%E4%BD%9C%E6%8A%BD%E8%B1%A1%E9%A1%9E%E5%88%A5">🔻 實作抽象類別</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span> : <span class="hljs-title">Animal</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Speak</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{Name}</span> 汪汪叫！"</span>);
    }
}
</div></code></pre>
<h3 id="%E8%AA%AA%E6%98%8E">說明：</h3>
<ul>
<li>抽象類別提供<strong>共用邏輯</strong></li>
<li>子類別<strong>強制使用 override 關鍵字實作</strong>抽象方法</li>
</ul>
<hr>
<h2 id="%F0%9F%93%8E-%E4%BB%8B%E9%9D%A2interface">📎 介面（interface）</h2>
<h3 id="%E5%AE%9A%E7%BE%A9">定義</h3>
<p>介面是一組<strong>沒有實作</strong>的方法與屬性的集合，僅定義規格，類似「合約、約定」。<br>
合約或約定的內容明白的定義了可以執行的方法名稱。</p>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IFlyable</span>
{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Fly</span>(<span class="hljs-params"></span>)</span>;
}
</div></code></pre>
<h3 id="%E5%AF%A6%E4%BD%9C">實作：</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Bird</span> : <span class="hljs-title">IFlyable</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Fly</span>(<span class="hljs-params"></span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">"小鳥飛起來了！"</span>);
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%A7%A9-%E5%A4%9A%E9%87%8D%E4%BB%8B%E9%9D%A2%E5%AF%A6%E4%BD%9C">🧩 多重介面實作</h2>
<p>C# 支援類別實作多個介面：<BR>
Duck 可以飛也可以走，且飛跟走是由不同的生理系統負責。</p>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IFlyable</span>
{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Fly</span>(<span class="hljs-params"></span>)</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IWalkable</span>
{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Walk</span>(<span class="hljs-params"></span>)</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">WingSystem</span> : <span class="hljs-title">IFlyable</span> {
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Charge</span>(<span class="hljs-params"></span>)</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Duck</span> : <span class="hljs-title">WingSystem</span>, <span class="hljs-title">IWalkable</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Fly</span>(<span class="hljs-params"></span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">"鴨子飛起來！"</span>);
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Walk</span>(<span class="hljs-params"></span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">"鴨子走起來！"</span>);
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Charge</span>(<span class="hljs-params"></span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">"鴨子振翅疾飛！"</span>);
}
</div></code></pre>
<p>鳥類大多數都會實作 <code>IFlyable</code> 及 <code>IWalkable</code>，但陸地生物大多數都不會實作 <code>IFlyable</code>，因此：</p>
<pre class="hljs"><code><div><span class="hljs-comment">// 這就是一個錯誤的用法，因為佩佩豬沒有實作 IFlyable。</span>
Pig p佩佩豬 = <span class="hljs-keyword">new</span> Pig();

<span class="hljs-comment">// 1. 轉型失敗</span>
IFlyable fly = p佩佩豬;

<span class="hljs-comment">//2. 無法呼叫 Fly() 函式。</span>
fly.Fly();
</div></code></pre>
<hr>
<h2 id="%F0%9F%86%9A-%E6%8A%BD%E8%B1%A1%E9%A1%9E%E5%88%A5-vs-%E4%BB%8B%E9%9D%A2-%E6%AF%94%E8%BC%83%E8%A1%A8">🆚 抽象類別 vs 介面 比較表</h2>
<table>
<thead>
<tr>
<th>項目</th>
<th>抽象類別（abstract）</th>
<th>介面（interface）</th>
</tr>
</thead>
<tbody>
<tr>
<td>可否有實作？</td>
<td>✅ 可有部分實作</td>
<td>❌ C# 7 前不可有任何實作, C# 8 後可以</td>
</tr>
<tr>
<td>繼承數量</td>
<td>❌ 僅限單一繼承</td>
<td>✅ 可多介面實作</td>
</tr>
<tr>
<td>設計用途</td>
<td>提供模板與擴充機制</td>
<td>定義合約與行為規格</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="%F0%9F%93%9D-%E7%B7%B4%E7%BF%92%E9%A1%8C">📝 練習題</h2>
<h3 id="%E9%A1%8C%E7%9B%AE-1">題目 1：</h3>
<p>定義一個抽象類別 <code>Shape</code>，其中包含抽象方法 <code>GetArea()</code>，再由 <code>Rectangle</code>, <code>Circle</code> 繼承並實作。</p>
<h3 id="%E9%A1%8C%E7%9B%AE-2">題目 2：</h3>
<p>定義介面 <code>IDriveable</code>，讓 <code>Car</code> 和 <code>Motorbike</code> 實作該介面並提供 <code>Drive()</code> 實作。</p>
<hr>
<h2 id="%E2%9C%85-%E7%B7%B4%E7%BF%92%E9%A1%8C%E8%A7%A3%E7%AD%94">✅ 練習題解答</h2>
<h3 id="%E9%A1%8C%E7%9B%AE-1-%E8%A7%A3%E7%AD%94">題目 1 解答：</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Shape</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">double</span> <span class="hljs-title">GetArea</span>(<span class="hljs-params"></span>)</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Rectangle</span> : <span class="hljs-title">Shape</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> Width { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> Height { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">double</span> <span class="hljs-title">GetArea</span>(<span class="hljs-params"></span>)</span> =&gt; Width * Height;
}
</div></code></pre>
<h3 id="%E9%A1%8C%E7%9B%AE-2-%E8%A7%A3%E7%AD%94">題目 2 解答：</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IDriveable</span>
{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Drive</span>(<span class="hljs-params"></span>)</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> : <span class="hljs-title">IDriveable</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Drive</span>(<span class="hljs-params"></span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">"汽車行駛中"</span>);
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Motorbike</span> : <span class="hljs-title">IDriveable</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Drive</span>(<span class="hljs-params"></span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">"機車行駛中"</span>);
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%A7%A0-%E5%B0%8F%E7%B5%90">🧠 小結</h2>
<ul>
<li>抽象類別提供<strong>共用結構與部分邏輯</strong></li>
<li>介面定義<strong>行為合約</strong>，適合建立系統協定</li>
<li><B><U>抽象類別適用於「is-a(是一種什麼：Animal - Pig - Speak)」，
介面適用於「can-do(可以做什麼：IFlyable - Duck - Fly)」</U></B></li>
</ul>
<hr>
<h1 id="%F0%9F%93%98-%E7%AC%AC-5-%E7%AB%A0%E9%A1%9E%E5%88%A5%E8%A8%AD%E8%A8%88%E5%8E%9F%E5%89%87%E8%88%87%E4%BE%9D%E8%B3%B4%E6%B3%A8%E5%85%A5">📘 第 5 章：類別設計原則與依賴注入</h1>
<h2 id="%F0%9F%8E%AF-%E6%95%99%E5%AD%B8%E7%9B%AE%E6%A8%99">🎯 教學目標</h2>
<ul>
<li>學習如何設計低耦合、高內聚的類別結構</li>
<li>理解「單一職責原則」（SRP）與「依賴反轉原則」（DIP）</li>
<li>實作「建構子注入」與「介面注入」</li>
<li>理解依賴注入容器的基本角色（進階）</li>
</ul>
<hr>
<h2 id="%F0%9F%A7%B1-%E5%96%AE%E4%B8%80%E8%81%B7%E8%B2%AC%E5%8E%9F%E5%89%87-srpsingle-responsibility-principle">🧱 單一職責原則 SRP(Single Responsibility Principle)</h2>
<blockquote>
<p>一個類別應該只負責一件事情。</p>
</blockquote>
<h3 id="%E2%9D%8C-%E5%8F%8D%E4%BE%8B">❌ 反例</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Report</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Title;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Generate</span>(<span class="hljs-params"></span>)</span> { <span class="hljs-comment">/* ... */</span> }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SaveToFile</span>(<span class="hljs-params"></span>)</span> { <span class="hljs-comment">/* IO 操作 */</span> }
}
</div></code></pre>
<p>🔍 問題：</p>
<ul>
<li><code>Report</code> 類別負責兩件事：「產生報表」與「檔案處理」</li>
</ul>
<hr>
<h3 id="%E2%9C%85-%E9%87%8D%E6%A7%8B%E5%BE%8C%E7%9A%84-srp">✅ 重構後的 SRP</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ReportGenerator</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GenerateReport</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-string">"報表內容..."</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FileSaver</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Save</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> content</span>)</span>
    {
        File.WriteAllText(<span class="hljs-string">"report.txt"</span>, content);
    }
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%8C%9F-openclosed-principle%E9%96%8B%E6%94%BE%E5%B0%81%E9%96%89%E5%8E%9F%E5%89%87">🌟 Open/Closed Principle（開放封閉原則）</h2>
<hr>
<h3 id="%F0%9F%93%8C-%E5%AE%9A%E7%BE%A9definition">📌 定義（Definition）</h3>
<blockquote>
<p><strong>Open/Closed Principle（OCP）</strong> 指的是：</p>
<blockquote>
<p><strong>「軟體實體（如：類別、模組、函式）應對擴充開放，對修改封閉。」</strong></p>
</blockquote>
<p>意即：</p>
<ul>
<li><strong>可以透過擴展的方式來改變行為</strong></li>
<li><strong>但不要直接修改現有的程式碼</strong></li>
</ul>
</blockquote>
<p>這是 <strong>SOLID</strong> 原則中的第二個原則，是物件導向設計中提升可維護性與擴展性的核心思想。</p>
<hr>
<h2 id="%F0%9F%94%8D-%E7%AC%AC%E4%B8%80%E5%8E%9F%E7%90%86%E6%8B%86%E8%A7%A3first-principles-breakdown">🔍 第一原理拆解（First-Principles Breakdown）</h2>
<table>
<thead>
<tr>
<th>元素</th>
<th>解釋</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>目標</strong></td>
<td>在不修改既有程式碼的前提下，允許系統行為的改變</td>
</tr>
<tr>
<td><strong>原因</strong></td>
<td>減少對現有穩定模組的影響，降低 bug、提高穩定性</td>
</tr>
<tr>
<td><strong>達成方法</strong></td>
<td>使用抽象（interface / abstract class）與多型（polymorphism）來擴展功能</td>
</tr>
<tr>
<td><strong>關鍵技術</strong></td>
<td>Interface, Inheritance, Delegation, Strategy Pattern</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="%E2%9D%8C-%E9%8C%AF%E8%AA%A4%E7%A4%BA%E7%AF%84%E9%81%95%E5%8F%8D-ocp">❌ 錯誤示範（違反 OCP）</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DiscountCalculator</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">CalculateDiscount</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> customerType, <span class="hljs-keyword">double</span> amount</span>)</span>
    {
        <span class="hljs-keyword">if</span> (customerType == <span class="hljs-string">"Regular"</span>)
        {
            <span class="hljs-keyword">return</span> amount * <span class="hljs-number">0.9</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (customerType == <span class="hljs-string">"Premium"</span>)
        {
            <span class="hljs-keyword">return</span> amount * <span class="hljs-number">0.8</span>;
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-keyword">return</span> amount;
        }
    }
}
</div></code></pre>
<h3 id="%E5%95%8F%E9%A1%8C%E5%88%86%E6%9E%90">問題分析：</h3>
<ul>
<li>如果加入新的 <code>customerType</code>（如 VIP、Enterprise），就必須 <strong>修改這段程式碼</strong>。</li>
<li>違反 OCP，因為這不是「封閉對修改」的設計。</li>
</ul>
<hr>
<h2 id="%E2%9C%85-%E6%AD%A3%E7%A2%BA%E7%A4%BA%E7%AF%84%E7%AC%A6%E5%90%88-ocp">✅ 正確示範（符合 OCP）</h2>
<h3 id="1-%E6%8A%BD%E8%B1%A1%E7%AD%96%E7%95%A5%E4%BB%8B%E9%9D%A2">1. 抽象策略介面：</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IDiscountStrategy</span>
{
    <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">ApplyDiscount</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> amount</span>)</span>;
}
</div></code></pre>
<h3 id="2-%E5%90%84%E7%A8%AE%E6%8A%98%E6%89%A3%E7%AD%96%E7%95%A5%E6%93%B4%E5%B1%95%E4%B8%8D%E4%BF%AE%E6%94%B9">2. 各種折扣策略（擴展不修改）：</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">RegularDiscount</span> : <span class="hljs-title">IDiscountStrategy</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">ApplyDiscount</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> amount</span>)</span> =&gt; amount * <span class="hljs-number">0.9</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PremiumDiscount</span> : <span class="hljs-title">IDiscountStrategy</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">ApplyDiscount</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> amount</span>)</span> =&gt; amount * <span class="hljs-number">0.8</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">NoDiscount</span> : <span class="hljs-title">IDiscountStrategy</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">ApplyDiscount</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> amount</span>)</span> =&gt; amount;
}
</div></code></pre>
<h3 id="3-%E6%8A%98%E6%89%A3%E8%A8%88%E7%AE%97%E5%99%A8">3. 折扣計算器：</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DiscountCalculator</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IDiscountStrategy _discountStrategy;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DiscountCalculator</span>(<span class="hljs-params">IDiscountStrategy discountStrategy</span>)</span>
    {
        _discountStrategy = discountStrategy;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">Calculate</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> amount</span>)</span>
    {
        <span class="hljs-keyword">return</span> _discountStrategy.ApplyDiscount(amount);
    }
}
</div></code></pre>
<h3 id="4-%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F">4. 使用方式：</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
    {
        IDiscountStrategy strategy = <span class="hljs-keyword">new</span> PremiumDiscount(); <span class="hljs-comment">// 可替換為 RegularDiscount, NoDiscount</span>
        <span class="hljs-keyword">var</span> calculator = <span class="hljs-keyword">new</span> DiscountCalculator(strategy);

        <span class="hljs-keyword">double</span> finalAmount = calculator.Calculate(<span class="hljs-number">1000</span>);
        Console.WriteLine(<span class="hljs-string">$"最終金額：<span class="hljs-subst">{finalAmount}</span>"</span>);
    }
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%8E%AF-%E9%81%94%E6%88%90-ocp-%E7%9A%84%E6%95%88%E6%9E%9C">🎯 達成 OCP 的效果：</h2>
<table>
<thead>
<tr>
<th>項目</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>🔄 擴展能力</td>
<td>新增 <code>EnterpriseDiscount</code> 僅需實作一個新類別，不需動到其他程式碼</td>
</tr>
<tr>
<td>🛡️ 安全性</td>
<td>不會破壞既有行為，降低風險</td>
</tr>
<tr>
<td>🧩 模組化</td>
<td>每個折扣策略是獨立模組，易於測試與替換</td>
</tr>
<tr>
<td>💡 設計模式</td>
<td>使用了 <strong>策略模式（Strategy Pattern）</strong> 來實現 OCP</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="%F0%9F%93%9A-%E5%BB%B6%E4%BC%B8%E6%87%89%E7%94%A8%E5%A0%B4%E6%99%AF">📚 延伸應用場景：</h2>
<ul>
<li>金流處理（不同支付方式）</li>
<li>訂單計算（不同促銷策略）</li>
<li>日誌系統（不同寫入方式：檔案、資料庫、雲端）</li>
<li>驗證邏輯（不同驗證方式：帳密、OTP、OAuth）</li>
</ul>
<hr>
<h2 id="%F0%9F%A7%A0-%E7%B8%BD%E7%B5%90%E8%AA%9E">🧠 總結語：</h2>
<table>
<thead>
<tr>
<th>屬性</th>
<th>價值</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>開放性</strong></td>
<td>可以新增功能</td>
</tr>
<tr>
<td><strong>封閉性</strong></td>
<td>不需動到穩定的程式碼</td>
</tr>
<tr>
<td><strong>手段</strong></td>
<td>抽象化 + 多型性 + 設計模式</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="%F0%9F%94%81-%E4%BE%9D%E8%B3%B4%E5%8F%8D%E8%BD%89%E5%8E%9F%E5%89%87-dip">🔁 依賴反轉原則 DIP</h2>
<blockquote>
<p>高階模組不應該依賴低階模組，兩者應依賴抽象。</p>
</blockquote>
<hr>
<h3 id="%E2%9C%85-%E5%BB%BA%E6%A7%8B%E5%AD%90%E6%B3%A8%E5%85%A5constructor-injection">✅ 建構子注入（Constructor Injection）</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">ILogger</span>
{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Log</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> message</span>)</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FileLogger</span> : <span class="hljs-title">ILogger</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Log</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> message</span>)</span>
    {
        File.AppendAllText(<span class="hljs-string">"log.txt"</span>, message + <span class="hljs-string">"\n"</span>);
    }
}

❌ <span class="hljs-comment">//永遠只能用 FileLogger，以後有更進階好用的 Logger 也用不了。</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> FileLogger _logger;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserService</span>(<span class="hljs-params">FileLogger logger</span>)</span>
    {
        _logger = logger;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateUser</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span>
    {
        _logger.Log(<span class="hljs-string">$"使用者 <span class="hljs-subst">{name}</span> 建立成功"</span>);
    }
}

❌ <span class="hljs-comment">// 這就變成高階的 UserService 依賴低階的 FileLogger</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span>
{
    <span class="hljs-keyword">private</span> FileLogger _logger = <span class="hljs-keyword">new</span> FileLogger();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateUser</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span>
    {
        _logger.Log(<span class="hljs-string">$"使用者 <span class="hljs-subst">{name}</span> 建立成功"</span>);
    }
}

✅ <span class="hljs-comment">//依賴由注入來完成，且依賴的對象是抽象，以後各種 Logger 都可以被放進來用</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger _logger;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserService</span>(<span class="hljs-params">ILogger logger</span>)</span>
    {
        _logger = logger;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateUser</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span>
    {
        _logger.Log(<span class="hljs-string">$"使用者 <span class="hljs-subst">{name}</span> 建立成功"</span>);
    }
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%A7%AA-%E4%BD%BF%E7%94%A8%E7%AF%84%E4%BE%8B">🧪 使用範例</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">var</span> logger = <span class="hljs-keyword">new</span> FileLogger();
<span class="hljs-keyword">var</span> service = <span class="hljs-keyword">new</span> UserService(logger);
service.CreateUser(<span class="hljs-string">"小明"</span>);
</div></code></pre>
<hr>
<h2 id="%F0%9F%94%84-%E4%BB%8B%E9%9D%A2%E6%B3%A8%E5%85%A5interface-injection">🔄 介面注入（Interface Injection）</h2>
<h3 id="%E5%AF%A6%E4%BD%9C%E7%AF%84%E4%BE%8B">實作範例</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">INotifier</span>
{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Notify</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> msg</span>)</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SmsNotifier</span> : <span class="hljs-title">INotifier</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Notify</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> msg</span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">$"SMS: <span class="hljs-subst">{msg}</span>"</span>);
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">NotificationService</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Send</span>(<span class="hljs-params">INotifier notifier</span>)</span>
    {
        notifier.Notify(<span class="hljs-string">"您有新通知"</span>);
    }
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%9D-%E7%B7%B4%E7%BF%92%E9%A1%8C">📝 練習題</h2>
<h3 id="%E9%A1%8C%E7%9B%AE-1">題目 1：</h3>
<p>實作一個 <code>ILogger</code> 介面與兩種實作類別（<code>ConsoleLogger</code>、<code>FileLogger</code>）</p>
<h3 id="%E9%A1%8C%E7%9B%AE-2">題目 2：</h3>
<p>設計一個 <code>EmailService</code> 使用建構子注入 <code>ILogger</code></p>
<hr>
<h2 id="%E2%9C%85-%E8%A7%A3%E7%AD%94%E5%8F%83%E8%80%83">✅ 解答參考</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ConsoleLogger</span> : <span class="hljs-title">ILogger</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Log</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> message</span>)</span> =&gt; Console.WriteLine(<span class="hljs-string">$"[Console] <span class="hljs-subst">{message}</span>"</span>);
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EmailService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger _logger;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">EmailService</span>(<span class="hljs-params">ILogger logger</span>)</span>
    {
        _logger = logger;
    }
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%9A-%E5%B0%8F%E7%B5%90">📚 小結</h2>
<ul>
<li>低耦合的關鍵在於「依賴抽象」而非具體實作</li>
<li>使用注入模式可以讓程式模組更具可測試性與可維護性</li>
<li>單一職責原則能提升系統可維護性與擴充性</li>
</ul>
<hr>
<h1 id="%F0%9F%93%98-%E7%AC%AC-6-%E7%AB%A0%E6%B3%9B%E5%9E%8B%E8%88%87%E9%9B%86%E5%90%88generics--collections">📘 第 6 章：泛型與集合（Generics &amp; Collections）</h1>
<h2 id="%F0%9F%8E%AF-%E6%95%99%E5%AD%B8%E7%9B%AE%E6%A8%99">🎯 教學目標</h2>
<ul>
<li>瞭解泛型的概念與用途</li>
<li>能定義泛型類別與泛型方法</li>
<li>熟悉 C# 內建泛型集合（List、Dictionary、Queue、Stack）</li>
<li>實作泛型資料結構與應用</li>
</ul>
<hr>
<h2 id="%F0%9F%93%A6-%E6%B3%9B%E5%9E%8B%E6%A6%82%E5%BF%B5generics">📦 泛型概念（Generics）</h2>
<h3 id="%E5%95%8F%E9%A1%8C%E8%83%8C%E6%99%AF">問題背景</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">IntBox</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Value { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Print</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(Value);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StringBox</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Value { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Print</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(Value);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BooleanBox</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> Value { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Print</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(Value);
    }
}
<span class="hljs-comment">//......</span>
<span class="hljs-comment">//....</span>
<span class="hljs-comment">//.........</span>
</div></code></pre>
<p>🔧 缺點：每種型別都需要一個類別 → 無法重用</p>
<hr>
<h3 id="%E2%9C%85-%E6%B3%9B%E5%9E%8B%E9%A1%9E%E5%88%A5%E5%AE%9A%E7%BE%A9">✅ 泛型類別定義</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Box</span>&lt;<span class="hljs-title">T</span>&gt;
{
    <span class="hljs-keyword">public</span> T Value { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Print</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(Value);
    }
}
</div></code></pre>
<h3 id="%E4%BD%BF%E7%94%A8">使用：</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">var</span> intBox = <span class="hljs-keyword">new</span> Box&lt;<span class="hljs-keyword">int</span>&gt; { Value = <span class="hljs-number">123</span> };
intBox.Print();

<span class="hljs-keyword">var</span> stringBox = <span class="hljs-keyword">new</span> Box&lt;<span class="hljs-keyword">string</span>&gt; { Value = <span class="hljs-string">"Hello"</span> };
stringBox.Print();
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%A6-%E6%B3%9B%E5%9E%8B%E6%96%B9%E6%B3%95">📦 泛型方法</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Printer</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> Print&lt;T&gt;(T data)
    {
        Console.WriteLine(data);
    }
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%9A-%E5%B8%B8%E7%94%A8%E6%B3%9B%E5%9E%8B%E9%9B%86%E5%90%88">📚 常用泛型集合</h2>
<h3 id="listt%E5%8F%AF%E8%AE%8A%E9%95%B7%E5%BA%A6%E9%99%A3%E5%88%97"><code>List&lt;T&gt;</code>：可變長度陣列</h3>
<pre class="hljs"><code><div>List&lt;<span class="hljs-keyword">string</span>&gt; names = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();
names.Add(<span class="hljs-string">"小明"</span>);
names.Add(<span class="hljs-string">"小美"</span>);
</div></code></pre>
<h3 id="dictionarykv%E9%8D%B5%E5%80%BC%E5%B0%8D%E9%9B%86%E5%90%88"><code>Dictionary&lt;K,V&gt;</code>：鍵值對集合</h3>
<pre class="hljs"><code><div>Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">int</span>&gt; ages = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">int</span>&gt;();
ages[<span class="hljs-string">"小明"</span>] = <span class="hljs-number">20</span>;
</div></code></pre>
<h3 id="queuet%E5%85%88%E9%80%B2%E5%85%88%E5%87%BAfifo"><code>Queue&lt;T&gt;</code>：先進先出（FIFO）</h3>
<pre class="hljs"><code><div>Queue&lt;<span class="hljs-keyword">string</span>&gt; tasks = <span class="hljs-keyword">new</span> Queue&lt;<span class="hljs-keyword">string</span>&gt;();
tasks.Enqueue(<span class="hljs-string">"任務A"</span>);
tasks.Dequeue(); <span class="hljs-comment">// 出隊</span>
</div></code></pre>
<h3 id="stackt%E5%BE%8C%E9%80%B2%E5%85%88%E5%87%BAlifo"><code>Stack&lt;T&gt;</code>：後進先出（LIFO）</h3>
<pre class="hljs"><code><div>Stack&lt;<span class="hljs-keyword">string</span>&gt; history = <span class="hljs-keyword">new</span> Stack&lt;<span class="hljs-keyword">string</span>&gt;();
history.Push(<span class="hljs-string">"頁面1"</span>);
history.Pop(); <span class="hljs-comment">// 回到上一頁</span>
</div></code></pre>
<hr>
<h2 id="%F0%9F%A7%AA-%E5%AF%A6%E4%BD%9C%E6%B3%9B%E5%9E%8B-stack">🧪 實作：泛型 Stack</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyStack</span>&lt;<span class="hljs-title">T</span>&gt;
{
    <span class="hljs-keyword">private</span> List&lt;T&gt; _list = <span class="hljs-keyword">new</span> List&lt;T&gt;();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Push</span>(<span class="hljs-params">T item</span>)</span> =&gt; _list.Add(item);
    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">Pop</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">var</span> item = _list[_list.Count - <span class="hljs-number">1</span>];
        _list.RemoveAt(_list.Count - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> item;
    }
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%9D-%E7%B7%B4%E7%BF%92%E9%A1%8C">📝 練習題</h2>
<h3 id="%E9%A1%8C%E7%9B%AE-1">題目 1：</h3>
<p>定義泛型類別 <code>Pair&lt;T1, T2&gt;</code>，可同時儲存兩種型別的值</p>
<h3 id="%E9%A1%8C%E7%9B%AE-2">題目 2：</h3>
<p>使用 <code>Dictionary&lt;string, List&lt;int&gt;&gt;</code> 記錄每個學生的多次測驗成績</p>
<hr>
<h2 id="%E2%9C%85-%E8%A7%A3%E7%AD%94%E5%8F%83%E8%80%83">✅ 解答參考</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Pair</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>&gt;
{
    <span class="hljs-keyword">public</span> T1 First { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> T2 Second { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</div></code></pre>
<pre class="hljs"><code><div>Dictionary&lt;<span class="hljs-keyword">string</span>, List&lt;<span class="hljs-keyword">int</span>&gt;&gt; scores = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">string</span>, List&lt;<span class="hljs-keyword">int</span>&gt;&gt;();
scores[<span class="hljs-string">"小明"</span>] = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt; { <span class="hljs-number">90</span>, <span class="hljs-number">85</span>, <span class="hljs-number">88</span> };
</div></code></pre>
<hr>
<h2 id="%F0%9F%A7%A0-%E5%B0%8F%E7%B5%90">🧠 小結</h2>
<table>
<thead>
<tr>
<th>類型</th>
<th>特性</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>List&lt;T&gt;</code></td>
<td>動態陣列</td>
</tr>
<tr>
<td><code>Dictionary&lt;K,V&gt;</code></td>
<td>鍵值對查詢</td>
</tr>
<tr>
<td><code>Queue&lt;T&gt;</code></td>
<td>排隊處理（FIFO）</td>
</tr>
<tr>
<td><code>Stack&lt;T&gt;</code></td>
<td>回朔堆疊（LIFO）</td>
</tr>
</tbody>
</table>
<p>泛型是撰寫可重複使用、型別安全程式碼的關鍵。</p>
<hr>
<h1 id="%F0%9F%93%98-%E7%AC%AC-7-%E7%AB%A0%E9%80%B2%E9%9A%8E%E6%B3%9B%E5%9E%8B">📘 第 7 章：進階泛型</h1>
<ul>
<li><strong>泛型的核心思想：</strong> 泛型允許我們在設計類別、介面和方法時，將「型別」本身作為一個參數。這讓我們可以編寫出 <strong>型別安全 (Type-Safe)</strong> 且可重用的程式碼，而無需為每種資料型別都重寫一次。</li>
<li><strong>泛型解決的問題：</strong> 在沒有泛型之前，若要寫一個可儲存任何型別的容器，通常使用 <code>object</code> 型別。但這樣做有兩個缺點：
<ol>
<li><strong>效能問題：</strong> 值型別（如 <code>int</code>, <code>double</code>）存入時需要「裝箱」(Boxing)，取出時需要「拆箱」(Unboxing)，這會帶來額外的效能開銷。</li>
<li><strong>型別不安全：</strong> 從容器取出 <code>object</code> 後，需要手動轉型回原始型別，一不小心就可能轉型失敗而導致執行時期錯誤。</li>
</ol>
</li>
<li><strong>泛型約束 (<code>where T : ...</code>)</strong>
<ul>
<li>有時我們需要對泛型參數 <code>T</code> 做一些限制，確保它具備某些能力。例如，我們可能需要 <code>T</code> 必須是一個類別、必須有預設建構函式，或必須實作某個介面。</li>
<li>常用約束：<code>where T : class</code> (必須是參考型別), <code>where T : struct</code> (必須是實值型別), <code>where T : new()</code> (必須有公開無參數建構函式), <code>where T : SomeBaseClass</code>, <code>where T : ISomeInterface</code>。</li>
</ul>
</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Box</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">where</span> <span class="hljs-title">T</span> : <span class="hljs-title">class</span>
{
    <span class="hljs-keyword">public</span> T Value { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-keyword">var</span> b1 = <span class="hljs-keyword">new</span> Box&lt;<span class="hljs-keyword">int</span>&gt;();❌
<span class="hljs-keyword">var</span> b2 = <span class="hljs-keyword">new</span> Box&lt;Dog&gt;();✅

<span class="hljs-comment">//</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Box</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">where</span> <span class="hljs-title">T</span> : <span class="hljs-title">struct</span>
{
    <span class="hljs-keyword">public</span> T Value { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
<span class="hljs-keyword">var</span> b3 = <span class="hljs-keyword">new</span> Box&lt;<span class="hljs-keyword">int</span>&gt;();✅
<span class="hljs-keyword">var</span> b4 = <span class="hljs-keyword">new</span> Box&lt;Dog&gt;();❌
</div></code></pre>
<hr>
<h1 id="%F0%9F%93%9D-%E4%B8%AD%E9%AB%98%E9%9A%8E-oop-%E7%B7%B4%E7%BF%92%E9%A1%8C%E8%A8%82%E5%96%AE%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88">📝 中高階 OOP 練習題：訂單系統設計</h1>
<h3 id="%E9%A1%8C%E7%9B%AE%E8%AA%AA%E6%98%8E">題目說明</h3>
<p>請設計一個簡易「訂單系統」，需包含以下要求：</p>
<hr>
<h3 id="1-%E5%95%86%E5%93%81product"><strong>1. 商品（Product）</strong></h3>
<ul>
<li>
<p><strong>抽象類別 <code>Product</code></strong></p>
<ul>
<li>
<p>屬性：</p>
<ul>
<li><code>string Name</code></li>
<li><code>decimal Price</code></li>
</ul>
</li>
<li>
<p>抽象方法：</p>
<ul>
<li><code>string GetDescription()</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>請實作兩種商品：</p>
<ol>
<li><code>Book</code>（書籍）：額外屬性 <code>Author</code></li>
<li><code>Food</code>（食品）：額外屬性 <code>ExpirationDate</code></li>
</ol>
</li>
<li>
<p>各自覆寫 <code>GetDescription()</code>，顯示詳細資訊（包含額外屬性）。</p>
</li>
</ul>
<hr>
<h3 id="2-%E6%8A%98%E6%89%A3%E7%AD%96%E7%95%A5discount"><strong>2. 折扣策略（Discount）</strong></h3>
<ul>
<li>
<p><strong>介面 <code>IDiscountStrategy</code></strong></p>
<ul>
<li>
<p>方法：</p>
<ul>
<li><code>decimal ApplyDiscount(decimal originalPrice)</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>實作以下折扣策略：</p>
<ol>
<li><code>NoDiscount</code>（無折扣）</li>
<li><code>PercentageDiscount</code>（百分比折扣，建構子接受折扣百分比）</li>
<li><code>ThresholdDiscount</code>（滿額折扣，建構子接受滿額金額與折扣金額）</li>
</ol>
</li>
</ul>
<hr>
<h3 id="3-%E8%A8%82%E5%96%AE%E9%A0%85%E7%9B%AEorderitem"><strong>3. 訂單項目（OrderItem）</strong></h3>
<ul>
<li>
<p>屬性：</p>
<ul>
<li><code>Product Product</code></li>
<li><code>int Quantity</code></li>
<li><code>IDiscountStrategy DiscountStrategy</code></li>
</ul>
</li>
<li>
<p>方法：</p>
<ul>
<li><code>decimal GetTotalPrice()</code>
計算 <code>(單價 × 數量)</code> 後再套用折扣策略。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="4-%E8%A8%82%E5%96%AEorder"><strong>4. 訂單（Order）</strong></h3>
<ul>
<li>
<p>屬性：</p>
<ul>
<li><code>List&lt;OrderItem&gt; Items</code></li>
<li><code>DateTime OrderDate</code></li>
</ul>
</li>
<li>
<p>方法：</p>
<ul>
<li><code>void AddItem(OrderItem item)</code>
需檢查同類商品是否已存在，若存在則合併數量。</li>
<li><code>decimal GetTotalAmount()</code>
回傳整張訂單的總金額。</li>
<li><code>void PrintOrderDetails()</code>
逐項列印商品資訊與小計，最後印出總金額。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="5-%E4%BE%8B%E5%A4%96%E8%99%95%E7%90%86exception-handling"><strong>5. 例外處理（Exception Handling）</strong></h3>
<ul>
<li>若新增的 <code>OrderItem</code> 數量小於等於 0，應拋出自訂例外 <code>InvalidQuantityException</code>。</li>
<li>若折扣策略計算後價格小於 0，應自動調整為 0 並紀錄警告訊息。</li>
</ul>
<hr>
<h3 id="6-%E6%B8%AC%E8%A9%A6%E6%83%85%E5%A2%83"><strong>6. 測試情境</strong></h3>
<p>請在 <code>Main()</code> 中完成以下操作：</p>
<ol>
<li>建立幾個 <code>Book</code> 與 <code>Food</code> 物件。</li>
<li>建立多種 <code>IDiscountStrategy</code> 實例（如無折扣、打八折、滿 500 減 50）。</li>
<li>建立一張 <code>Order</code>，加入不同的 <code>OrderItem</code>，並套用不同折扣策略。</li>
<li>印出完整訂單明細與總金額。</li>
<li>嘗試新增數量為 0 的商品，觸發例外處理並捕捉錯誤訊息。</li>
</ol>
<hr>
<p>💡 <strong>設計要點</strong>：</p>
<ul>
<li>需正確使用 <strong>抽象類別、介面、多型、封裝、繼承</strong>。</li>
<li>折扣策略必須可以動態替換（策略模式）。</li>
<li>訂單與訂單項目的關聯應該符合「一張訂單包含多個訂單項目」的關係。</li>
<li>適當使用例外處理保證系統穩定。</li>
</ul>
<hr>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Collections.Generic;

<span class="hljs-comment">// ========== 自訂例外 ==========</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">InvalidQuantityException</span> : <span class="hljs-title">Exception</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">InvalidQuantityException</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> message</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">message</span>)</span> { }
}

<span class="hljs-comment">// ========== 抽象類別：商品 ==========</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> Price { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Product</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">decimal</span> price</span>)</span>
    {
        <span class="hljs-keyword">if</span> (price &lt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"價格不能為負數"</span>);

        Name = name;
        Price = price;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetDescription</span>(<span class="hljs-params"></span>)</span>;
}

<span class="hljs-comment">// ========== 商品類別：書籍 ==========</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> : <span class="hljs-title">Product</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Author { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Book</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">decimal</span> price, <span class="hljs-keyword">string</span> author</span>)
        : <span class="hljs-title">base</span>(<span class="hljs-params">name, price</span>)</span>
    {
        Author = author;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetDescription</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"書籍: <span class="hljs-subst">{Name}</span>, 作者: <span class="hljs-subst">{Author}</span>, 單價: <span class="hljs-subst">{Price:C}</span>"</span>;
    }
}

<span class="hljs-comment">// ========== 商品類別：食品 ==========</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Food</span> : <span class="hljs-title">Product</span>
{
    <span class="hljs-keyword">public</span> DateTime ExpirationDate { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Food</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">decimal</span> price, DateTime expirationDate</span>)
        : <span class="hljs-title">base</span>(<span class="hljs-params">name, price</span>)</span>
    {
        ExpirationDate = expirationDate;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetDescription</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"食品: <span class="hljs-subst">{Name}</span>, 有效期限: <span class="hljs-subst">{ExpirationDate:yyyy-MM-dd}</span>, 單價: <span class="hljs-subst">{Price:C}</span>"</span>;
    }
}

<span class="hljs-comment">// ========== 折扣策略介面 ==========</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IDiscountStrategy</span>
{
    <span class="hljs-function"><span class="hljs-keyword">decimal</span> <span class="hljs-title">ApplyDiscount</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> originalPrice</span>)</span>;
}

<span class="hljs-comment">// 無折扣</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">NoDiscount</span> : <span class="hljs-title">IDiscountStrategy</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> <span class="hljs-title">ApplyDiscount</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> originalPrice</span>)</span> =&gt; originalPrice;
}

<span class="hljs-comment">// 百分比折扣</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PercentageDiscount</span> : <span class="hljs-title">IDiscountStrategy</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">decimal</span> _percentage; <span class="hljs-comment">// 例如 0.2 代表打 8 折</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PercentageDiscount</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> percentage</span>)</span>
    {
        <span class="hljs-keyword">if</span> (percentage &lt; <span class="hljs-number">0</span> || percentage &gt; <span class="hljs-number">1</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"折扣百分比必須介於 0 與 1 之間"</span>);

        _percentage = percentage;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> <span class="hljs-title">ApplyDiscount</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> originalPrice</span>)</span>
    {
        <span class="hljs-keyword">decimal</span> result = originalPrice * (<span class="hljs-number">1</span> - _percentage);
        <span class="hljs-keyword">return</span> result &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : result;
    }
}

<span class="hljs-comment">// 滿額折扣</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThresholdDiscount</span> : <span class="hljs-title">IDiscountStrategy</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">decimal</span> _threshold;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">decimal</span> _discountAmount;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThresholdDiscount</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> threshold, <span class="hljs-keyword">decimal</span> discountAmount</span>)</span>
    {
        _threshold = threshold;
        _discountAmount = discountAmount;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> <span class="hljs-title">ApplyDiscount</span>(<span class="hljs-params"><span class="hljs-keyword">decimal</span> originalPrice</span>)</span>
    {
        <span class="hljs-keyword">decimal</span> result = originalPrice;
        <span class="hljs-keyword">if</span> (originalPrice &gt;= _threshold)
            result -= _discountAmount;

        <span class="hljs-keyword">return</span> result &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : result;
    }
}

<span class="hljs-comment">// ========== 訂單項目 ==========</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OrderItem</span>
{
    <span class="hljs-keyword">public</span> Product Product { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Quantity { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> IDiscountStrategy DiscountStrategy { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">OrderItem</span>(<span class="hljs-params">Product product, <span class="hljs-keyword">int</span> quantity, IDiscountStrategy discountStrategy</span>)</span>
    {
        <span class="hljs-keyword">if</span> (quantity &lt;= <span class="hljs-number">0</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQuantityException(<span class="hljs-string">"商品數量必須大於 0"</span>);

        Product = product;
        Quantity = quantity;
        DiscountStrategy = discountStrategy ?? <span class="hljs-keyword">new</span> NoDiscount();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> <span class="hljs-title">GetTotalPrice</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">decimal</span> total = Product.Price * Quantity;
        <span class="hljs-keyword">decimal</span> discounted = DiscountStrategy.ApplyDiscount(total);

        <span class="hljs-keyword">if</span> (discounted &lt; <span class="hljs-number">0</span>)
        {
            Console.WriteLine(<span class="hljs-string">"[警告] 折扣後金額小於 0，自動調整為 0"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }

        <span class="hljs-keyword">return</span> discounted;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AddQuantity</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> qty</span>)</span>
    {
        <span class="hljs-keyword">if</span> (qty &lt;= <span class="hljs-number">0</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQuantityException(<span class="hljs-string">"新增數量必須大於 0"</span>);

        Quantity += qty;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{Product.GetDescription()}</span> × <span class="hljs-subst">{Quantity}</span>, 折扣後小計: <span class="hljs-subst">{GetTotalPrice():C}</span>"</span>;
    }
}

<span class="hljs-comment">// ========== 訂單 ==========</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Order</span>
{
    <span class="hljs-keyword">public</span> List&lt;OrderItem&gt; Items { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span> List&lt;OrderItem&gt;();
    <span class="hljs-keyword">public</span> DateTime OrderDate { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Order</span>(<span class="hljs-params"></span>)</span>
    {
        OrderDate = DateTime.Now;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AddItem</span>(<span class="hljs-params">OrderItem item</span>)</span>
    {
        <span class="hljs-comment">// 檢查是否已有相同商品</span>
        <span class="hljs-keyword">var</span> existing = Items.Find(i =&gt; i.Product.Name == item.Product.Name);
        <span class="hljs-keyword">if</span> (existing != <span class="hljs-literal">null</span>)
        {
            existing.AddQuantity(item.Quantity);
        }
        <span class="hljs-keyword">else</span>
        {
            Items.Add(item);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> <span class="hljs-title">GetTotalAmount</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">decimal</span> sum = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> Items)
        {
            sum += item.GetTotalPrice();
        }
        <span class="hljs-keyword">return</span> sum;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PrintOrderDetails</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"===== 訂單明細 ====="</span>);
        Console.WriteLine(<span class="hljs-string">$"訂單日期: <span class="hljs-subst">{OrderDate}</span>"</span>);
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> Items)
        {
            Console.WriteLine(item);
        }
        Console.WriteLine(<span class="hljs-string">$"總金額: <span class="hljs-subst">{GetTotalAmount():C}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">"==================="</span>);
    }
}

<span class="hljs-comment">// ========== 測試程式 ==========</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-comment">// 建立商品</span>
            <span class="hljs-keyword">var</span> book1 = <span class="hljs-keyword">new</span> Book(<span class="hljs-string">"C# 深入解析"</span>, <span class="hljs-number">800</span>, <span class="hljs-string">"陳大師"</span>);
            <span class="hljs-keyword">var</span> food1 = <span class="hljs-keyword">new</span> Food(<span class="hljs-string">"巧克力蛋糕"</span>, <span class="hljs-number">350</span>, DateTime.Now.AddDays(<span class="hljs-number">7</span>));
            <span class="hljs-keyword">var</span> food2 = <span class="hljs-keyword">new</span> Food(<span class="hljs-string">"蘋果"</span>, <span class="hljs-number">30</span>, DateTime.Now.AddDays(<span class="hljs-number">10</span>));

            <span class="hljs-comment">// 建立折扣策略</span>
            <span class="hljs-keyword">var</span> noDiscount = <span class="hljs-keyword">new</span> NoDiscount();
            <span class="hljs-keyword">var</span> discount20 = <span class="hljs-keyword">new</span> PercentageDiscount(<span class="hljs-number">0.2</span>m); <span class="hljs-comment">// 8 折</span>
            <span class="hljs-keyword">var</span> thresholdDiscount = <span class="hljs-keyword">new</span> ThresholdDiscount(<span class="hljs-number">500</span>, <span class="hljs-number">50</span>);

            <span class="hljs-comment">// 建立訂單</span>
            <span class="hljs-keyword">var</span> order = <span class="hljs-keyword">new</span> Order();
            order.AddItem(<span class="hljs-keyword">new</span> OrderItem(book1, <span class="hljs-number">1</span>, discount20));
            order.AddItem(<span class="hljs-keyword">new</span> OrderItem(food1, <span class="hljs-number">2</span>, thresholdDiscount));
            order.AddItem(<span class="hljs-keyword">new</span> OrderItem(food2, <span class="hljs-number">10</span>, noDiscount));

            <span class="hljs-comment">// 顯示訂單</span>
            order.PrintOrderDetails();

            <span class="hljs-comment">// 測試數量為 0 的例外</span>
            Console.WriteLine(<span class="hljs-string">"\n[測試例外處理]"</span>);
            order.AddItem(<span class="hljs-keyword">new</span> OrderItem(food2, <span class="hljs-number">0</span>, noDiscount)); <span class="hljs-comment">// 會拋出例外</span>
        }
        <span class="hljs-keyword">catch</span> (InvalidQuantityException ex)
        {
            Console.WriteLine(<span class="hljs-string">$"[錯誤] <span class="hljs-subst">{ex.Message}</span>"</span>);
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            Console.WriteLine(<span class="hljs-string">$"[未預期錯誤] <span class="hljs-subst">{ex.Message}</span>"</span>);
        }
    }
}

</div></code></pre>

</body>
</html>
